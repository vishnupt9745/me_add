import{r as a,w as Fr,bF as K,bm as kr,a1 as ir,a2 as Br,b0 as Tr,u as _r,j as h,I as L,L as dr,bG as Wr,s as lr,bH as fr}from"./index.CAj-7vWz.js";const _=a.createContext(null);_.displayName="BidiComponentContext";const T=Fr.getLogger("BidiComponent"),Y="__",W="__streamlit_arrow_ref__",Ur="$$STREAMLIT_INTERNAL_KEY",Lr=(r,e)=>{if(r&&typeof r=="object"&&!Array.isArray(r)){if(typeof r[W]=="string"){const t=r[W],n=e[t];if(n)try{return K(n)}catch{return null}return null}const o={};for(const[t,n]of Object.entries(r))if(n&&typeof n=="object"&&!Array.isArray(n)&&typeof n[W]=="string"){const u=n[W],s=e[u];if(s)try{o[t]=K(s)}catch{o[t]=null}else o[t]=null}else o[t]=n;return o}return r},Ar=({arrowBlobs:r,arrowData:e,bytes:o,data:t,json:n,mixedJson:u})=>{switch(t){case"json":return n?JSON.parse(n):null;case"arrowData":return e??null;case"bytes":return o??null;case"mixed":{if(u&&r&&u){const s=JSON.parse(u),c={};return r&&Object.entries(r).forEach(([f,l])=>{l?.data&&(c[f]=l.data)}),Lr(s,c)}return null}case"any":case void 0:return null;default:kr(t)}};var A,X;function Ir(){if(X)return A;X=1;function r(e,o,t,n){var u=-1,s=e==null?0:e.length;for(n&&s&&(t=e[++u]);++u<s;)t=o(t,e[u],u,e);return t}return A=r,A}var I,Q;function Or(){if(Q)return I;Q=1;function r(e){return function(o){return e?.[o]}}return I=r,I}var O,rr;function zr(){if(rr)return O;rr=1;var r=Or(),e={À:"A",Á:"A",Â:"A",Ã:"A",Ä:"A",Å:"A",à:"a",á:"a",â:"a",ã:"a",ä:"a",å:"a",Ç:"C",ç:"c",Ð:"D",ð:"d",È:"E",É:"E",Ê:"E",Ë:"E",è:"e",é:"e",ê:"e",ë:"e",Ì:"I",Í:"I",Î:"I",Ï:"I",ì:"i",í:"i",î:"i",ï:"i",Ñ:"N",ñ:"n",Ò:"O",Ó:"O",Ô:"O",Õ:"O",Ö:"O",Ø:"O",ò:"o",ó:"o",ô:"o",õ:"o",ö:"o",ø:"o",Ù:"U",Ú:"U",Û:"U",Ü:"U",ù:"u",ú:"u",û:"u",ü:"u",Ý:"Y",ý:"y",ÿ:"y",Æ:"Ae",æ:"ae",Þ:"Th",þ:"th",ß:"ss",Ā:"A",Ă:"A",Ą:"A",ā:"a",ă:"a",ą:"a",Ć:"C",Ĉ:"C",Ċ:"C",Č:"C",ć:"c",ĉ:"c",ċ:"c",č:"c",Ď:"D",Đ:"D",ď:"d",đ:"d",Ē:"E",Ĕ:"E",Ė:"E",Ę:"E",Ě:"E",ē:"e",ĕ:"e",ė:"e",ę:"e",ě:"e",Ĝ:"G",Ğ:"G",Ġ:"G",Ģ:"G",ĝ:"g",ğ:"g",ġ:"g",ģ:"g",Ĥ:"H",Ħ:"H",ĥ:"h",ħ:"h",Ĩ:"I",Ī:"I",Ĭ:"I",Į:"I",İ:"I",ĩ:"i",ī:"i",ĭ:"i",į:"i",ı:"i",Ĵ:"J",ĵ:"j",Ķ:"K",ķ:"k",ĸ:"k",Ĺ:"L",Ļ:"L",Ľ:"L",Ŀ:"L",Ł:"L",ĺ:"l",ļ:"l",ľ:"l",ŀ:"l",ł:"l",Ń:"N",Ņ:"N",Ň:"N",Ŋ:"N",ń:"n",ņ:"n",ň:"n",ŋ:"n",Ō:"O",Ŏ:"O",Ő:"O",ō:"o",ŏ:"o",ő:"o",Ŕ:"R",Ŗ:"R",Ř:"R",ŕ:"r",ŗ:"r",ř:"r",Ś:"S",Ŝ:"S",Ş:"S",Š:"S",ś:"s",ŝ:"s",ş:"s",š:"s",Ţ:"T",Ť:"T",Ŧ:"T",ţ:"t",ť:"t",ŧ:"t",Ũ:"U",Ū:"U",Ŭ:"U",Ů:"U",Ű:"U",Ų:"U",ũ:"u",ū:"u",ŭ:"u",ů:"u",ű:"u",ų:"u",Ŵ:"W",ŵ:"w",Ŷ:"Y",ŷ:"y",Ÿ:"Y",Ź:"Z",Ż:"Z",Ž:"Z",ź:"z",ż:"z",ž:"z",Ĳ:"IJ",ĳ:"ij",Œ:"Oe",œ:"oe",ŉ:"'n",ſ:"s"},o=r(e);return O=o,O}var z,er;function Mr(){if(er)return z;er=1;var r=zr(),e=ir(),o=/[\xc0-\xd6\xd8-\xf6\xf8-\xff\u0100-\u017f]/g,t="\\u0300-\\u036f",n="\\ufe20-\\ufe2f",u="\\u20d0-\\u20ff",s=t+n+u,c="["+s+"]",f=RegExp(c,"g");function l(d){return d=e(d),d&&d.replace(o,r).replace(f,"")}return z=l,z}var M,or;function jr(){if(or)return M;or=1;var r=/[^\x00-\x2f\x3a-\x40\x5b-\x60\x7b-\x7f]+/g;function e(o){return o.match(r)||[]}return M=e,M}var j,tr;function Nr(){if(tr)return j;tr=1;var r=/[a-z][A-Z]|[A-Z]{2}[a-z]|[0-9][a-zA-Z]|[a-zA-Z][0-9]|[^a-zA-Z0-9 ]/;function e(o){return r.test(o)}return j=e,j}var N,nr;function qr(){if(nr)return N;nr=1;var r="\\ud800-\\udfff",e="\\u0300-\\u036f",o="\\ufe20-\\ufe2f",t="\\u20d0-\\u20ff",n=e+o+t,u="\\u2700-\\u27bf",s="a-z\\xdf-\\xf6\\xf8-\\xff",c="\\xac\\xb1\\xd7\\xf7",f="\\x00-\\x2f\\x3a-\\x40\\x5b-\\x60\\x7b-\\xbf",l="\\u2000-\\u206f",d=" \\t\\x0b\\f\\xa0\\ufeff\\n\\r\\u2028\\u2029\\u1680\\u180e\\u2000\\u2001\\u2002\\u2003\\u2004\\u2005\\u2006\\u2007\\u2008\\u2009\\u200a\\u202f\\u205f\\u3000",i="A-Z\\xc0-\\xd6\\xd8-\\xde",R="\\ufe0e\\ufe0f",b=c+f+l+d,p="['’]",C="["+b+"]",g="["+n+"]",y="\\d+",w="["+u+"]",S="["+s+"]",m="[^"+r+b+y+u+s+i+"]",E="\\ud83c[\\udffb-\\udfff]",x="(?:"+g+"|"+E+")",F="[^"+r+"]",k="(?:\\ud83c[\\udde6-\\uddff]){2}",v="[\\ud800-\\udbff][\\udc00-\\udfff]",B="["+i+"]",pr="\\u200d",H="(?:"+S+"|"+m+")",br="(?:"+B+"|"+m+")",V="(?:"+p+"(?:d|ll|m|re|s|t|ve))?",J="(?:"+p+"(?:D|LL|M|RE|S|T|VE))?",G=x+"?",Z="["+R+"]?",mr="(?:"+pr+"(?:"+[F,k,v].join("|")+")"+Z+G+")*",hr="\\d*(?:1st|2nd|3rd|(?![123])\\dth)(?=\\b|[A-Z_])",Rr="\\d*(?:1ST|2ND|3RD|(?![123])\\dTH)(?=\\b|[a-z_])",vr=Z+G+mr,yr="(?:"+[w,k,v].join("|")+")"+vr,Sr=RegExp([B+"?"+S+"+"+V+"(?="+[C,B,"$"].join("|")+")",br+"+"+J+"(?="+[C,B+H,"$"].join("|")+")",B+"?"+H+"+"+V,B+"+"+J,Rr,hr,y,yr].join("|"),"g");function Er(wr){return wr.match(Sr)||[]}return N=Er,N}var q,ur;function Pr(){if(ur)return q;ur=1;var r=jr(),e=Nr(),o=ir(),t=qr();function n(u,s,c){return u=o(u),s=c?void 0:s,s===void 0?e(u)?t(u):r(u):u.match(s)||[]}return q=n,q}var P,sr;function $r(){if(sr)return P;sr=1;var r=Ir(),e=Mr(),o=Pr(),t="['’]",n=RegExp(t,"g");function u(s){return function(c){return r(o(e(c).replace(n,"")),s,"")}}return P=u,P}var $,ar;function Dr(){if(ar)return $;ar=1;var r=$r(),e=r(function(o,t,n){return o+(n?"-":"")+t.toLowerCase()});return $=e,$}var Hr=Dr();const Vr=Br(Hr),Jr=(r,e="--st")=>{const o={};return Object.entries(r).forEach(([t,n])=>{const u=Vr(t),s=`${e}-${u}`;if(typeof n=="boolean"){o[s]=n?"1":"0";return}o[s]=String(n)}),o},Gr=r=>({primaryColor:r.colors.primary,backgroundColor:r.colors.bgColor,secondaryBackgroundColor:r.colors.secondaryBg,textColor:r.colors.bodyText,linkColor:r.colors.link,linkUnderline:r.linkUnderline,headingFont:r.genericFonts.headingFont,codeFont:r.genericFonts.codeFont,baseRadius:r.radii.default,buttonRadius:r.radii.button,baseFontSize:typeof r.fontSizes.baseFontSize=="number"?`${r.fontSizes.baseFontSize}px`:String(r.fontSizes.baseFontSize),baseFontWeight:r.fontWeights.normal,codeFontWeight:r.fontWeights.code,codeFontSize:r.fontSizes.codeFontSize,headingFontSizes:[r.fontSizes.h1FontSize,r.fontSizes.h2FontSize,r.fontSizes.h3FontSize,r.fontSizes.h4FontSize,r.fontSizes.h5FontSize,r.fontSizes.h6FontSize],headingFontWeights:[r.fontWeights.h1FontWeight,r.fontWeights.h2FontWeight,r.fontWeights.h3FontWeight,r.fontWeights.h4FontWeight,r.fontWeights.h5FontWeight,r.fontWeights.h6FontWeight],borderColor:r.colors.borderColor,dataframeBorderColor:r.colors.dataframeBorderColor,dataframeHeaderBackgroundColor:r.colors.dataframeHeaderBackgroundColor,codeBackgroundColor:r.colors.codeBackgroundColor,font:r.genericFonts.bodyFont,chartCategoricalColors:r.colors.chartCategoricalColors,chartSequentialColors:r.colors.chartSequentialColors,headingColor:r.colors.headingColor,borderColorLight:r.colors.borderColorLight,codeTextColor:r.colors.codeTextColor,widgetBorderColor:r.colors.widgetBorderColor,redColor:r.colors.redColor,orangeColor:r.colors.orangeColor,yellowColor:r.colors.yellowColor,blueColor:r.colors.blueColor,greenColor:r.colors.greenColor,violetColor:r.colors.violetColor,grayColor:r.colors.grayColor,redBackgroundColor:r.colors.redBackgroundColor,orangeBackgroundColor:r.colors.orangeBackgroundColor,yellowBackgroundColor:r.colors.yellowBackgroundColor,blueBackgroundColor:r.colors.blueBackgroundColor,greenBackgroundColor:r.colors.greenBackgroundColor,violetBackgroundColor:r.colors.violetBackgroundColor,grayBackgroundColor:r.colors.grayBackgroundColor,redTextColor:r.colors.redTextColor,orangeTextColor:r.colors.orangeTextColor,yellowTextColor:r.colors.yellowTextColor,blueTextColor:r.colors.blueTextColor,greenTextColor:r.colors.greenTextColor,violetTextColor:r.colors.violetTextColor,grayTextColor:r.colors.grayTextColor}),Zr=a.memo(({element:r,children:e,widgetMgr:o,fragmentId:t})=>{const{arrowData:n,bytes:u,componentName:s,cssContent:c,cssSourcePath:f,data:l,htmlContent:d,id:i,jsContent:R,json:b,jsSourcePath:p,mixed:C}=r,g=a.useMemo(()=>({id:r.id,formId:r.formId}),[r.id,r.formId]),y=a.useCallback(()=>{const x=o.getJsonValue(g);if(!x)return{};try{return JSON.parse(x)}catch(F){const k=Tr(F);return T.warn("Failed to parse widget JSON value; returning empty object.",{widgetId:g.id,formId:g.formId,error:k.message}),{}}},[g,o]),w=a.useMemo(()=>Ar({arrowBlobs:C?.arrowBlobs||void 0,arrowData:n?.data||void 0,bytes:u,data:l,json:b,mixedJson:C?.json||void 0}),[l,b,n?.data,u,C?.json,C?.arrowBlobs]),S=_r(),m=a.useMemo(()=>Gr(S),[S]),E=a.useMemo(()=>({componentName:s,cssContent:c?.trim(),cssSourcePath:f||void 0,data:w,fragmentId:t,getWidgetValue:y,htmlContent:d?.trim(),id:i,formId:r.formId||void 0,jsContent:R||void 0,jsSourcePath:p||void 0,theme:m,widgetMgr:o}),[s,c,f,t,y,d,i,r.formId,R,p,w,m,o]);return h(_.Provider,{value:E,children:e})}),Cr=(r,e)=>{if(r instanceof Error)return r;const o=e?`${e}: ${String(r)}`:String(r);return new Error(o)},U=(r,e,o)=>{const t=Cr(r,o);T.error(`BidiComponent Error: ${t.message}`,r),e(t)},Kr=(r,e)=>{try{const t=document.createRange().createContextualFragment(r);e.appendChild(t)}catch(o){T.warn("createContextualFragment failed, falling back to innerHTML",o),e.innerHTML=r}},gr=({containerRef:r,setError:e,skip:o=!1})=>{const t=a.useRef(null),{htmlContent:n,cssContent:u,cssSourcePath:s,componentName:c}=L(_),{componentRegistry:{getBidiComponentURL:f}}=a.useContext(dr),l=a.useMemo(()=>{if(s)return f(c,s)},[c,s,f]);return a.useEffect(()=>{if(o)return;const d=r.current;if(d)try{if(t.current&&t.current.parentNode===d&&d.removeChild(t.current),t.current=document.createElement("div"),n){const i=document.createElement("div");Kr(n,i),t.current.appendChild(i)}if(u){const i=document.createElement("style");i.textContent=u,t.current.appendChild(i)}else if(l){const i=document.createElement("link");i.href=l,i.rel="stylesheet",i.onerror=()=>{U(new Error(`Failed to load CSS from ${l}`),e)},t.current.appendChild(i)}d.appendChild(t.current)}catch(i){U(i,e,"Failed to process HTML/CSS content")}},[n,u,r,l,e,o]),t};class Yr{constructor(){this.hashSeed=2166136261,this.hashPrime=16777619,this.cache=new Map}computeHash(e){let o=this.hashSeed;for(let t=0;t<e.length;t++)o^=e.charCodeAt(t),o=Math.imul(o>>>0,this.hashPrime)>>>0;return(o>>>0).toString(16)}getOrCreateUrlForJs(e,o){const t=this.computeHash(e),n=this.cache.get(t);if(n)return{url:n,hash:t};const u=`${e}
//# sourceURL=${o}-${t}.js`,s=new Blob([u],{type:"text/javascript"}),c=URL.createObjectURL(s);return this.cache.set(t,c),{url:c,hash:t}}}const Xr=new Yr,Qr="events";function re(r){if(r.includes(Y))throw new Error("Base component id must not contain the delimiter sequence");return`${Ur}_${r}${Y}${Qr}`}const cr=async({componentId:r,componentIdForWidgetMgr:e,componentName:o,data:t,formId:n,fragmentId:u,getWidgetValue:s,moduleUrl:c,parentElement:f,widgetMgr:l})=>{const d=await import(c);if(!d)throw new Error("JS module does not exist.");if(!d.default||typeof d.default!="function")throw new Error("JS module does not have a default export function.");const i=(b,p)=>{let C={};try{C={...s(),[b]:p}}catch(g){T.error(`Failed to get existing value for ${b}`,g),C={[b]:p}}l.setJsonValue({id:e,formId:n},C,{fromUi:!0},u)},R=(b,p)=>{if(n){T.warn("BidiComponent: setTriggerValue ignored inside st.form. Triggers are not allowed in forms; use setStateValue and form submit instead.");return}const C=re(e);l.setTriggerValue({id:C,formId:n},{fromUi:!0},u,{event:b,value:p})};return d.default({name:o,data:t,key:r,parentElement:f,setStateValue:i,setTriggerValue:R})},xr=({containerRef:r,setError:e,skip:o=!1})=>{const n=`st-bidi-component-${a.useMemo(()=>Wr(),[])}`,{componentName:u,data:s,formId:c,fragmentId:f,getWidgetValue:l,id:d,jsContent:i,jsSourcePath:R,theme:b,widgetMgr:p}=L(_),{componentRegistry:{getBidiComponentURL:C}}=a.useContext(dr),g=a.useMemo(()=>{if(R)return C(u,R)},[u,R,C]),y=a.useRef(),w=a.useRef(),S=a.useRef(!1);a.useEffect(()=>{const{current:m}=r;if(o||!i&&!g||!m)return;(async()=>{try{if(i){const{url:x}=Xr.getOrCreateUrlForJs(i,`st-bidi-${u}`);y.current=await cr({componentId:n,componentIdForWidgetMgr:d,componentName:u,data:s,formId:c,fragmentId:f,getWidgetValue:l,moduleUrl:x,parentElement:m,widgetMgr:p})}else if(g){const x=g;try{await new Promise((F,k)=>{const v=document.createElement("script");v.type="module",v.src=x,v.async=!0,v.onload=()=>F(),v.onerror=()=>k(new Error(`Failed to load script from ${g}`)),document.head.appendChild(v),w.current=v}),y.current=await cr({componentId:n,componentIdForWidgetMgr:d,componentName:u,data:s,formId:c,fragmentId:f,getWidgetValue:l,moduleUrl:x,parentElement:m,widgetMgr:p})}catch(F){throw Cr(F,`Failed to load or execute script from ${g}`)}}}catch(x){S.current||U(x,e)}})()},[n,u,r,s,c,f,l,d,i,g,e,o,p,b]),a.useEffect(()=>()=>{S.current=!0;const m=y.current;m&&Promise.resolve(m).then(x=>{x?.()}).catch(x=>{T.error("Failed to run custom component cleanup",x)});const E=w.current;E?.parentNode&&E.parentNode.removeChild(E)},[])},ee=lr("div",{target:"e10xsstg0"})(({cssCustomProperties:r})=>({...r,display:"contents"})),D=lr("div",{target:"e10xsstg1"})({width:"100%",height:"100%"}),oe=a.memo(()=>{const r=a.useRef(null),e=a.useRef(null),[o,t]=a.useState(!1),[n,u]=a.useState(null),{id:s}=L(_);a.useEffect(()=>{if(r.current)try{if(r.current.shadowRoot){e.current=r.current.shadowRoot,t(!0);return}e.current=r.current.attachShadow({mode:"open"}),t(!0)}catch(f){U(f,u,"Failed to create shadow DOM")}},[s]);const c=!o||!!n;return gr({containerRef:e,setError:u,skip:c}),xr({containerRef:e,setError:u,skip:c}),n?h(fr,{name:"BidiComponent Error",message:n.message,stack:n.stack}):h(D,{ref:r,"data-testid":"stBidiComponentIsolated"})}),te=a.memo(()=>{const r=a.useRef(null),[e,o]=a.useState(null),t=!!e;return gr({containerRef:r,setError:o,skip:t}),xr({containerRef:r,setError:o,skip:t}),e?h(fr,{name:"BidiComponent Error",message:e.message,stack:e.stack}):h(D,{ref:r,"data-testid":"stBidiComponentRegular"})}),ne=({children:r})=>{const{theme:e}=L(_),o=a.useMemo(()=>Jr(e),[e]);return h(ee,{cssCustomProperties:o,children:r})},ue=({element:r,widgetMgr:e,fragmentId:o})=>{const{isolateStyles:t}=r;return h(Zr,{element:r,widgetMgr:e,fragmentId:o,children:h(D,{className:"stBidiComponent",children:h(ne,{children:t?h(oe,{}):h(te,{})})})})},ae=a.memo(ue);export{_ as BidiComponentContext,ae as default};
